<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ข้อมูลออเดอร์</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS สำหรับตกแต่งตารางและองค์ประกอบต่างๆ */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <h1 class="text-2xl font-bold mb-4">ข้อมูลออเดอร์</h1>

    <div class="mb-4">
        <label for="filterOrder" class="mr-2">เลขออเดอร์:</label>
        <input type="text" id="filterOrder" class="border border-gray-400 px-2 py-1 rounded">

        <label for="filterName" class="ml-4 mr-2">ชื่อเฟส:</label>
        <input type="text" id="filterName" class="border border-gray-400 px-2 py-1 rounded">

        <label for="filterPhone" class="ml-4 mr-2">เบอร์โทร:</label>
        <input type="text" id="filterPhone" class="border border-gray-400 px-2 py-1 rounded">

        <label for="filterStatus" class="ml-4 mr-2">สถานะ:</label>
        <select id="filterStatus" class="border border-gray-400 px-2 py-1 rounded">
            <option value="">ทั้งหมด</option>
            <option value="ออกแบบ">ออกแบบ</option>
            <option value="รอแก้แบบ">รอแก้แบบ</option>
            <option value="คอนเฟิร์ม">คอนเฟิร์ม</option>
            <option value="ผลิต">ผลิต</option>
            <option value="ตัด">ตัด</option>
            <option value="เคลม">เคลม</option>
            <option value="จัดส่ง">จัดส่ง</option>
            <option value="ยกเลิก">ยกเลิก</option>
        </select>
    </div>

    <table id="orderTable">
        <thead>
            <tr>
                <th>เลขออเดอร์</th>
                <th>ชื่อสินค้า</th>
                <th>ชื่อเฟส</th>
                <th>ที่อยู่</th>
                <th>เบอร์โทร</th>
                <th>สถานะ</th>
                <th>เลขพัสดุ</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <div class="mt-4">
        <button id="sortAscBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2">
            เรียงจากเก่าสุด
        </button>
        <button id="sortDescBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            เรียงจากล่าสุด
        </button>
    </div>

    <script>
        const SHEET_ID = '1kgaPVWljpYjMFzZJB1LTzr4Gma3lO4kpQSrhH_t5nJU';
        const SHEET_NAME1 = 'เพจ1';
        const SHEET_NAME2 = 'เพจ2';

        // ฟังก์ชันสำหรับดึงข้อมูลจาก Google Sheets
        async function fetchData(sheetName) {
            const response = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`);
            const data = await response.text();
            const jsonData = JSON.parse(data.substring(47).slice(0, -2));
            return jsonData.table.rows.map(row => row.c.map(cell => cell ? cell.v : ''));
        }

        // ฟังก์ชันสำหรับแสดงข้อมูลในตาราง
        function displayData(data) {
            const tableBody = document.getElementById('orderTable').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';

            data.forEach(row => {
                const newRow = tableBody.insertRow();
                const orderCell = newRow.insertCell();
                const productCell = newRow.insertCell();
                const nameCell = newRow.insertCell();
                const addressCell = newRow.insertCell();
                const phoneCell = newRow.insertCell();
                const statusCell = newRow.insertCell();
                const trackingCell = newRow.insertCell();

                orderCell.textContent = row[0]; // เลขออเดอร์ (คอลัมน์ A)
                productCell.textContent = row[1]; // ชื่อสินค้า (คอลัมน์ B)
                nameCell.textContent = row[3]; // ชื่อเฟส (คอลัมน์ D)
                addressCell.textContent = row[4]; // ที่อยู่ (คอลัมน์ E)
                phoneCell.textContent = row[5]; // เบอร์โทร (คอลัมน์ F)

                // สร้าง dropdown สำหรับสถานะ (คอลัมน์ G)
                const statusSelect = document.createElement('select');
                statusSelect.innerHTML = `
                    <option value="ออกแบบ" ${row[6] === 'ออกแบบ' ? 'selected' : ''}>ออกแบบ</option>
                    <option value="รอแก้แบบ" ${row[6] === 'รอแก้แบบ' ? 'selected' : ''}>รอแก้แบบ</option>
                    <option value="คอนเฟิร์ม" ${row[6] === 'คอนเฟิร์ม' ? 'selected' : ''}>คอนเฟิร์ม</option>
                    <option value="ผลิต" ${row[6] === 'ผลิต' ? 'selected' : ''}>ผลิต</option>
                    <option value="ตัด" ${row[6] === 'ตัด' ? 'selected' : ''}>ตัด</option>
                    <option value="เคลม" ${row[6] === 'เคลม' ? 'selected' : ''}>เคลม</option>
                    <option value="จัดส่ง" ${row[6] === 'จัดส่ง' ? 'selected' : ''}>จัดส่ง</option>
                    <option value="ยกเลิก" ${row[6] === 'ยกเลิก' ? 'selected' : ''}>ยกเลิก</option>
                `;
                statusCell.appendChild(statusSelect);

                trackingCell.textContent = row[20]; // เลขพัสดุ (คอลัมน์ U)
            });
        }

        // ฟังก์ชันสำหรับกรองข้อมูล
        function filterData(data) {
            const filterOrder = document.getElementById('filterOrder').value.toLowerCase();
            const filterName = document.getElementById('filterName').value.toLowerCase();
            const filterPhone = document.getElementById('filterPhone').value.toLowerCase();
            const filterStatus = document.getElementById('filterStatus').value;

            return data.filter(row => {
                const orderMatch = row[0].toLowerCase().includes(filterOrder);
                const nameMatch = row[3].toLowerCase().includes(filterName);
                const phoneMatch = row[5].toLowerCase().includes(filterPhone);
                const statusMatch = !filterStatus || row[6] === filterStatus;
                return orderMatch && nameMatch && phoneMatch && statusMatch;
            });
        }

        // ฟังก์ชันสำหรับเรียงลำดับข้อมูล
        function sortData(data, sortAsc) {
            return data.sort((a, b) => {
                const orderA = parseInt(a[0].replace(/[^0-9]/g, ''), 10);
                const orderB = parseInt(b[0].replace(/[^0-9]/g, ''), 10);
                return sortAsc ? orderA - orderB : orderB - orderA;
            });
        }

        // ดึงข้อมูลจากชีต "เพจ1" และ "เพจ2"
        Promise.all([fetchData(SHEET_NAME1), fetchData(SHEET_NAME2)])
            .then(results => {
                // รวมข้อมูลจากทั้งสองชีต
                const allData = [...results[0], ...results[1]];
                displayData(allData);

                // Event Listeners สำหรับการกรองข้อมูล
                document.getElementById('filterOrder').addEventListener('input', () => displayData(filterData(allData)));
                document.getElementById('filterName').addEventListener('input', () => displayData(filterData(allData)));
                document.getElementById('filterPhone').addEventListener('input', () => displayData(filterData(allData)));
                document.getElementById('filterStatus').addEventListener('change', () => displayData(filterData(allData)));

                // Event Listeners สำหรับการเรียงลำดับข้อมูล
                document.getElementById('sortAscBtn').addEventListener('click', () => displayData(sortData(filterData(allData), true)));
                document.getElementById('sortDescBtn').addEventListener('click', () => displayData(sortData(filterData(allData), false)));
            });
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
  <head>
<base target="_top">
<title>ข้อมูลรถยนต์ของคุณ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
font-family: Arial, sans-serif;
background-color: #1a1a1a; /* สีดำ /
color: #f0f0f0; / สีข้อความ /
padding: 20px;
margin: 0;
display: flex;
justify-content: center;
align-items: flex-start; / จัดให้เนื้อหาอยู่ด้านบน /
min-height: 100vh;
}
.container {
background-color: #2c2c2c; / สีดำเข้มขึ้น /
padding: 30px;
border-radius: 10px;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
max-width: 600px;
width: 100%;
border: 1px solid #FFD700; / สีเหลืองทอง /
}
h2 {
color: #FFD700; / สีเหลืองทอง /
text-align: center;
margin-bottom: 25px;
text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}
.registration-item {
background-color: #3a3a3a;
padding: 15px;
margin-bottom: 15px;
border-radius: 8px;
border: 1px solid #555;
}
.registration-item p {
margin: 5px 0;
}
.registration-item p strong {
color: #FFD700;
display: inline-block;
width: 120px; / เพื่อจัดแนวข้อความ /
}
#loadingSpinner {
display: none; / Hidden by default /
border: 4px solid #f3f3f3; / Light grey /
        border-top: 4px solid #FFD700; / Yellow gold */
border-radius: 50%;
width: 30px;
height: 30px;
animation: spin 2s linear infinite;
margin: 20px auto;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
.no-data-message {
text-align: center;
color: #FFD700;
font-size: 1.1em;
margin-top: 30px;
}
.close-button {
background-color: #555;
color: white;
padding: 10px 15px;
border: none;
border-radius: 5px;
cursor: pointer;
font-size: 16px;
margin-top: 20px;
width: 100%;
}
.close-button:hover {
background-color: #777;
}
</style>
<script src="https://static.line-scdn.net/liff/2.21.0/liff.js"></script>
</head>
<body>
<div class="container">
<h2>ข้อมูลรถยนต์ของคุณ</h2>
<div id="loadingSpinner"></div>
<div id="registrationsList"></div>
<div id="noDataMessage" class="no-data-message" style="display:none;">
<p>ไม่พบข้อมูลการลงทะเบียนสำหรับบัญชี Line นี้</p>
</div>
<button class="close-button" onclick="liff.closeWindow()">ปิดหน้าต่างนี้</button>
</div>

  <script>
    let lineUserID = '';

    window.onload = function() {
      liff.init({
        liffId: '2007499630-r04RVeeV' // เราจะมาใส่ LIFF ID ตรงนี้ในขั้นตอนถัดไป
      }).then(() => {
        if (liff.isLoggedIn()) {
          liff.getProfile().then(profile => {
            lineUserID = profile.userId;
            console.log('Line User ID:', lineUserID);
            fetchRegistrations();
          }).catch(err => {
            console.error(err);
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('noDataMessage').style.display = 'block';
          });
        } else {
          liff.login();
        }
      }).catch(err => {
        console.error('LIFF init failed', err);
        document.getElementById('loadingSpinner').style.display = 'none';
        document.getElementById('noDataMessage').style.display = 'block';
      });
    };

    function fetchRegistrations() {
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('registrationsList').innerHTML = '';
      document.getElementById('noDataMessage').style.display = 'none';

      google.script.run
        .withSuccessHandler(function(registrations) {
          document.getElementById('loadingSpinner').style.display = 'none';
          const listDiv = document.getElementById('registrationsList');
          if (registrations && registrations.length > 0) {
            registrations.forEach(reg => {
              const itemDiv = document.createElement('div');
              itemDiv.className = 'registration-item';
              itemDiv.innerHTML = `
                <p><strong>ชื่อ-สกุล:</strong> ${reg.Name}</p>
                <p><strong>เบอร์โทร:</strong> ${reg.PhoneNumber}</p>
                <p><strong>เลขทะเบียนรถ:</strong> ${reg.LicensePlate}</p>
                <p><strong>วันที่รับประกัน:</strong> ${reg.WarrantyDate}</p>
              `;
              listDiv.appendChild(itemDiv);
            });
          } else {
            document.getElementById('noDataMessage').style.display = 'block';
          }
        })
        .withFailureHandler(function(error) {
          console.error('Error fetching data:', error.message);
          document.getElementById('loadingSpinner').style.display = 'none';
          document.getElementById('noDataMessage').style.display = 'block';
        })
        .doPost({
          action: 'getRegistrationsByLineUserID',
          postData: {
            contents: JSON.stringify({ lineUserID: lineUserID })
          }
        });
    }
  </script>
</body>
</html>
```
